(function($){$.Zebra_Dialog=function(){var defaults={animation_speed:250,auto_close:false,buttons:true,custom_class:false,keyboard:true,message:"",modal:true,overlay_close:true,overlay_opacity:.9,position:"center",title:"",type:"information",vcenter_short_message:true,width:0,onClose:null,manualClose:null};var plugin=this;plugin.settings={};options={};if(typeof arguments[0]=="string")options.message=arguments[0];if(typeof arguments[0]=="object"||typeof arguments[1]=="object")options=$.extend(options,typeof arguments[0]=="object"?arguments[0]:arguments[1]);plugin.init=function(){plugin.settings=$.extend({},defaults,options);plugin.isIE6=$.browser.msie&&parseInt($.browser.version,10)==6||false;if(plugin.settings.modal){plugin.overlay=jQuery("<div>",{"class":"ZebraDialogOverlay"}).css({position:plugin.isIE6?"absolute":"fixed",left:0,top:0,opacity:plugin.settings.overlay_opacity,"z-index":1e3});if(plugin.settings.overlay_close)plugin.overlay.bind("click",function(){plugin.close()});plugin.overlay.appendTo("body")}plugin.dialog=jQuery("<div>",{"class":"ZebraDialog"+(plugin.settings.custom_class?" "+plugin.settings.custom_class:"")}).css({position:plugin.isIE6?"absolute":"fixed",left:0,top:0,"z-index":1001,visibility:"hidden"});if(!plugin.settings.buttons&&plugin.settings.auto_close)plugin.dialog.attr("id","ZebraDialog_"+Math.floor(Math.random()*9999999));var a=parseInt(plugin.settings.width);if(!isNaN(a)&&a==plugin.settings.width&&a.toString()==plugin.settings.width.toString()&&a>0)plugin.dialog.css({width:plugin.settings.width});if(plugin.settings.title)jQuery("<h3>",{"class":"ZebraDialog_Title"}).html(plugin.settings.title).appendTo(plugin.dialog);plugin.message=jQuery("<div>",{"class":"ZebraDialog_Body"+(get_type()!=""?" ZebraDialog_Icon ZebraDialog_"+get_type():"")});if(plugin.settings.vcenter_short_message)jQuery("<div>").html(plugin.settings.message).appendTo(plugin.message);else plugin.message.html(plugin.settings.message);plugin.message.appendTo(plugin.dialog);var b=get_buttons();if(b){var c=jQuery("<div>",{"class":"ZebraDialog_Buttons"}).appendTo(plugin.dialog);$.each(b,function(a,b){var d=jQuery("<a>",{href:"javascript:void(0)","class":"ZebraDialog_Button"+a});if($.isPlainObject(b))d.html(b.caption);else d.html(b);d.bind("click",function(){if(undefined!=b.callback)b.callback(plugin.dialog);plugin.close(undefined!=b.caption?b.caption:b)});d.appendTo(c)});jQuery("<div>",{style:"clear:both"}).appendTo(c)}plugin.dialog.appendTo("body");$(window).bind("resize",draw);if(plugin.settings.keyboard)$(document).bind("keyup",_keyup);if(plugin.isIE6)$(window).bind("scroll",_scroll);if(plugin.settings.auto_close!==false){plugin.dialog.bind("click",function(a){clearTimeout(plugin.timeout);plugin.close()});plugin.timeout=setTimeout(plugin.close,plugin.settings.auto_close)}draw();return plugin};plugin.close=function(a){if(plugin.settings.manualClose==true){return}if(plugin.settings.keyboard)$(document).unbind("keyup",_keyup);if(plugin.isIE6)$(window).unbind("scroll",_scroll);$(window).unbind("resize",draw);if(plugin.overlay)plugin.overlay.animate({opacity:0},plugin.settings.animation_speed,function(){plugin.overlay.remove()});plugin.dialog.animate({top:0,opacity:0},plugin.settings.animation_speed,function(){plugin.dialog.remove();if(plugin.settings.onClose&&typeof plugin.settings.onClose=="function")plugin.settings.onClose(undefined!=a?a:"")})};plugin.forceClose=function(){plugin.settings.manualClose=false;plugin.close()};var draw=function(){var viewport_width=$(window).width(),viewport_height=$(window).height(),dialog_width=plugin.dialog.width(),dialog_height=plugin.dialog.height(),values={left:0,top:0,right:viewport_width-dialog_width,bottom:viewport_height-dialog_height,center:(viewport_width-dialog_width)/2,middle:(viewport_height-dialog_height)/2};plugin.dialog_left=undefined;plugin.dialog_top=undefined;if(plugin.settings.modal)plugin.overlay.css({width:viewport_width,height:viewport_height});if($.isArray(plugin.settings.position)&&plugin.settings.position.length==2&&typeof plugin.settings.position[0]=="string"&&plugin.settings.position[0].match(/^(left|right|center)[\s0-9\+\-]*$/)&&typeof plugin.settings.position[1]=="string"&&plugin.settings.position[1].match(/^(top|bottom|middle)[\s0-9\+\-]*$/)){plugin.settings.position[0]=plugin.settings.position[0].toLowerCase();plugin.settings.position[1]=plugin.settings.position[1].toLowerCase();$.each(values,function(index,value){for(var i=0;i<2;i++){var tmp=plugin.settings.position[i].replace(index,value);if(tmp!=plugin.settings.position[i])if(i==0)plugin.dialog_left=eval(tmp);else plugin.dialog_top=eval(tmp)}})}if(undefined==plugin.dialog_left||undefined==plugin.dialog_top){plugin.dialog_left=values["center"];plugin.dialog_top=values["middle"]}if(plugin.settings.vcenter_short_message){var message=plugin.message.find("div:first"),message_height=message.height(),container_height=plugin.message.height();if(message_height<container_height)message.css({"margin-top":(container_height-message_height)/2})}plugin.dialog.css({left:plugin.dialog_left,top:plugin.dialog_top,visibility:"visible"});plugin.dialog.find("a[class^=ZebraDialog_Button]:first").focus();if(plugin.isIE6)setTimeout(emulate_fixed_position,500)};var emulate_fixed_position=function(){var a=$(window).scrollTop(),b=$(window).scrollLeft();if(plugin.settings.modal)plugin.overlay.css({top:a,left:b});plugin.dialog.css({left:plugin.dialog_left+b,top:plugin.dialog_top+a})};var get_buttons=function(){if(plugin.settings.buttons!==true&&!$.isArray(plugin.settings.buttons))return false;if(plugin.settings.buttons===true)switch(plugin.settings.type){case"question":plugin.settings.buttons=["Yes","No"];break;default:plugin.settings.buttons=["Ok"]}return plugin.settings.buttons.reverse()};var get_type=function(){switch(plugin.settings.type){case"confirmation":case"error":case"information":case"question":case"warning":return plugin.settings.type.charAt(0).toUpperCase()+plugin.settings.type.slice(1).toLowerCase();break;default:return false}};var _keyup=function(a){if(a.which==27)plugin.close();return true};var _scroll=function(){emulate_fixed_position()};return plugin.init()}})(jQuery)